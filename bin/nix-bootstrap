#!/usr/bin/env bash

set -eu

pwd
[[ ! -d /nix ]] && curl https://nixos.org/nix/install | sh
source ~/.nix-profile/etc/profile.d/nix.sh
if [[ -d ~/nixpkgs ]]; then
  (cd ~/nixpkgs; git pull)
else
  git clone https://github.com/NixOS/nixpkgs.git ~/nixpkgs
fi

sudo mkdir -p /etc/nix
cat >/tmp/nix.conf <<!
trusted-binary-caches = https://cache.nixos.org http://hydra.nixos.org http://hydra.cryp.to
binary-caches         = https://cache.nixos.org http://hydra.nixos.org http://hydra.cryp.to
!
sudo cp /tmp/nix.conf /etc/nix

nix-env -f ~/nixpkgs -i -A haskellngPackages.cabal2nix -A haskellngPackages.cabal-install

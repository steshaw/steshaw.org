machine:
  environment:
    GHC_VERSION: 7.10.1
    CABAL_VERSION: 1.22
    PATH: /opt/ghc/${GHC_VERSION}/bin:/opt/cabal/${CABAL_VERSION}/bin:${PATH}

checkout:
  pre:
    - git --version
  post:
    - git submodule sync
    - git submodule update --init

dependencies:
  pre:
    - bash -c '[[ -d /var/tmp/halcyon-cache ]] && ls -alFh /var/tmp/halcyon-cache || echo /var/tmp/halcyon-cache does not exist'
  cache_directories:
    - /var/tmp/halcyon-cache
  override:
    - bin/halcyon-setup
      #    - perl -pe 's/^set -eu$/set -eux/' -i /app/halcyon/halcyon
    - bin/build
  post:
    - bash -c '[[ -d /var/tmp/halcyon-cache ]] && ls -alFh /var/tmp/halcyon-cache || echo /var/tmp/halcyon-cache does not exist'

test:
  override:
    - bin/run

deployment:
  production:
    branch: master
    commands:
      - git config --global user.name 'Steven Shaw'
      - git config --global user.email 'steven@steshaw.org'
      - bin/deploy-to-github-pages "Circle (${CIRCLE_BUILD_NUM})"

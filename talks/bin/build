#!/usr/bin/env bash

set -euo pipefail
${DEBUG:-}

if [[ $# -ne 1 ]]; then
  echo "usage: $0 talk-name" >&2
  exit 2
fi

name=$1
src=${name}.org

#  -V revealjs-url:http://lab.hakim.se/reveal-js \
pandoc \
  --smart \
  --standalone \
  --css=https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css \
  -t revealjs \
  --slide-level 2 \
  -V theme:black \
  --output ${name}.html \
  ${src}

# Sadly, the setting the theme via the `theme` variable doesn't seem to work. Invoke Perl!
perl -p -e 's/simple\.css/black.css/; s/reveal\.min\./reveal./' -i ${name}.html

# FIX: hack for index.org
if [[ $name == 'index' ]]; then
  pdfBase="../$(basename $(pwd))"
else
  pdfBase="${name}"
fi

function BeamerPdf {
  pdf="${pdfBase}.beamer.pdf"

  which pdflatex && pandoc -t beamer -V theme:Madrid ${src} -o ${pdf} || echo 'Install pdflatex!'
}

function DeckTapePdf {
#  pdf="${pdfBase}.pdf"
  pdf="$(basename $(pwd)).pdf"
  file="$(pwd)/${name}.html"
#  docker run --rm -v `pwd`:/slides astefanutti/decktape http://lab.hakim.se/reveal-js slides.pdf

  docker run --rm \
    -v $(basename $(pwd)):/slides \
    -v ~:/home/steshaw \
    astefanutti/decktape "$file" "$pdf"

#  docker run astefanutti/decktape reveal ${url} ${pdf}
}

DeckTapePdf
BeamerPdf

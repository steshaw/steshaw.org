#!/usr/bin/env bash

set -eu
${DEBUG:-}

if [[ $# -ne 1 ]]; then
  echo "usage: $0 talk-name" >&2
  exit 2
fi

name=$1
src=${name}.org

#  -V revealjs-url:http://lab.hakim.se/reveal-js \
pandoc --smart -s -t revealjs --slide-level 2 -V theme:black \
  ${src} -o ${name}.html
# Sadly, the setting the theme via the `theme` variable doesn't seem to work. Invoke Perl!
perl -p -e 's/simple\.css/black.css/; s/reveal\.min\./reveal./' -i ${name}.html

# FIX: hack for index.org
if [[ $name == 'index' ]]; then
  pdf="../$(basename $(pwd)).pdf"
else
  pdf="${name}.pdf"
fi

which pdflatex && pandoc -t beamer -V theme:Madrid ${src} -o ${pdf} || echo 'Install pdflatex!'
